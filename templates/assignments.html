<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assignments - NexusBot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .glass-nav { background: rgba(17, 24, 39, 0.6); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    .assignment-card { transition: all 0.3s ease; }
    .assignment-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(14, 165, 233, 0.15); }
    
    /* Responsive Design */
    @media (max-width: 1400px) {
      .container-custom { max-width: 1200px; }
    }
    
    @media (max-width: 1200px) {
      .container-custom { max-width: 992px; }
    }
    
    @media (max-width: 992px) {
      .container-custom { max-width: 768px; }
      .grid.md\:grid-cols-2 { grid-template-columns: 1fr; }
      .grid.lg\:grid-cols-3 { grid-template-columns: repeat(2, 1fr); }
      .text-4xl { font-size: 2rem; }
      .text-2xl { font-size: 1.5rem; }
    }
    
    @media (max-width: 768px) {
      .container-custom { max-width: 576px; }
      .px-4 { padding-left: 1rem; padding-right: 1rem; }
      .px-6 { padding-left: 1rem; padding-right: 1rem; }
      .px-12 { padding-left: 1.5rem; padding-right: 1.5rem; }
      .py-12 { padding-top: 2rem; padding-bottom: 2rem; }
      .py-20 { padding-top: 2rem; padding-bottom: 2rem; }
      .text-4xl { font-size: 1.5rem; }
      .text-2xl { font-size: 1.25rem; }
      .text-lg { font-size: 0.875rem; }
      .mb-8 { margin-bottom: 1rem; }
      .mb-12 { margin-bottom: 1.5rem; }
      .gap-6 { gap: 0.75rem; }
      .p-8 { padding: 1rem; }
      .p-6 { padding: 0.75rem; }
      .grid.md\:grid-cols-2 { grid-template-columns: 1fr; }
      .grid.lg\:grid-cols-3 { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 600px) {
      .container-custom { max-width: 100%; padding: 0 0.75rem; }
      .px-4 { padding-left: 0.75rem; padding-right: 0.75rem; }
      .px-6 { padding-left: 0.75rem; padding-right: 0.75rem; }
      .px-12 { padding-left: 1rem; padding-right: 1rem; }
      .py-12 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
      .py-20 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
      .text-4xl { font-size: 1.25rem; }
      .text-2xl { font-size: 1.125rem; }
      .text-lg { font-size: 0.8rem; }
      .mb-8 { margin-bottom: 0.75rem; }
      .mb-12 { margin-bottom: 1rem; }
      .gap-6 { gap: 0.5rem; }
      .p-8 { padding: 0.75rem; }
      .p-6 { padding: 0.5rem; }
      .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
      .px-6 { padding-left: 0.75rem; padding-right: 0.75rem; }
    }
    
    /* Touch-friendly buttons */
    @media (max-width: 768px) {
      button {
        min-height: 44px;
      }
    }
    
    /* Prevent horizontal scroll */
    body {
      overflow-x: hidden;
    }
  </style>
</head>

<body class="bg-gray-900 antialiased text-gray-100">

  <header class="glass-nav fixed top-0 left-0 right-0 z-50">
    <div class="w-full mx-auto px-6 lg:px-12 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-white">
        <a href="{{ url_for('home') }}">Nexus<span class="text-sky-500">Bot</span></a>
      </h1>
      <div class="flex gap-4 items-center">
        <span id="botUsername" class="text-gray-300 text-sm"></span>
        <a href="{{ url_for('home') }}" class="bg-sky-500 text-white font-semibold px-4 py-2 rounded-lg hover:bg-sky-600 transition">Home</a>
      </div>
    </div>
  </header>

  <main class="pt-20 pb-8 sm:pb-12 container-custom mx-auto">
    <div class="w-full mx-auto px-3 sm:px-4 lg:px-12">
      
      <!-- Title -->
      <div class="mb-6 sm:mb-8 flex flex-col sm:flex-row justify-between items-start gap-4">
        <div>
          <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-1 sm:mb-2">Data Analysis Assignments</h2>
          <p class="text-gray-400 text-sm sm:text-base">Create and manage student data exploration tasks</p>
        </div>
        <button onclick="openCreateModal()" class="bg-sky-600 hover:bg-sky-700 text-white font-semibold px-4 sm:px-6 py-2 sm:py-3 rounded-lg transition text-sm sm:text-base min-h-[44px]">
          + Create Assignment
        </button>
      </div>

      <!-- Assignments Grid -->
      <div id="assignmentsList" class="grid md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6">
        <div class="col-span-full text-center text-gray-400 py-12">
          <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <p class="text-lg">No assignments yet</p>
          <p class="text-sm text-gray-500 mt-1">Create your first assignment to get started</p>
        </div>
      </div>

    </div>
  </main>

  <!-- Create Assignment Modal -->
  <div id="createModal" class="hidden fixed inset-0 bg-black/50 z-40 flex items-center justify-center p-4">
    <div class="bg-gray-800 rounded-lg border border-gray-700 p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <h3 class="text-2xl font-bold text-white mb-6">Create New Assignment</h3>
      
      <form id="assignmentForm" class="space-y-6">
        
        <div>
          <label class="block text-gray-300 mb-2 font-medium">Assignment Title</label>
          <input type="text" id="assignmentTitle" placeholder="e.g., Sales Data Analysis" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500">
        </div>

        <div>
          <label class="block text-gray-300 mb-2 font-medium">Description</label>
          <textarea id="assignmentDesc" placeholder="Describe what students should analyze..." rows="4" class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
        </div>

        <div>
          <label class="block text-gray-300 mb-2 font-medium">Select Data Source</label>
          <select id="assignmentData" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500">
            <option value="">-- Choose a template or your bot --</option>
            <option value="sales">Sales Dashboard</option>
            <option value="students">Student Records</option>
            <option value="experiment">Lab Experiment</option>
            <option value="economic">Economic Data</option>
            <option value="health">Health Data</option>
            <option value="survey">Survey Results</option>
          </select>
        </div>

        <div>
          <label class="block text-gray-300 mb-2 font-medium">Target Audience</label>
          <select id="assignmentAudience" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500">
            <option value="students">Students</option>
            <option value="class">Class Section</option>
            <option value="public">Public (Anyone)</option>
          </select>
        </div>

        <div>
          <label class="block text-gray-300 mb-2 font-medium">Due Date</label>
          <input type="date" id="assignmentDue" required class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500">
        </div>

        <div>
          <label class="block text-gray-300 mb-2 font-medium">Questions/Instructions (one per line)</label>
          <textarea id="assignmentQuestions" placeholder="What is the highest value?&#10;Find items where price > 50&#10;Which category has most items?" rows="4" class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
        </div>

        <div class="flex gap-3">
          <button type="submit" class="flex-1 bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 rounded-lg transition">
            Create Assignment
          </button>
          <button type="button" onclick="closeModal()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 rounded-lg transition">
            Cancel
          </button>
        </div>

      </form>
    </div>
  </div>

  <script type="module">
    // Simple local storage assignment system (no Firebase required)
    let currentUser = null;
    
    // Initialize with mock user or get from session
    function initializeUser() {
      // Try to get user from session storage or create mock user
      const storedUser = sessionStorage.getItem('mockUser');
      if (storedUser) {
        currentUser = JSON.parse(storedUser);
      } else {
        // Create a mock user for demo purposes
        currentUser = {
          uid: 'demo-user-' + Date.now(),
          email: 'demo@example.com',
          displayName: 'Demo User'
        };
        sessionStorage.setItem('mockUser', JSON.stringify(currentUser));
      }
      
      // Update UI
      const usernameEl = document.getElementById('botUsername');
      
      if (usernameEl) {
        usernameEl.textContent = currentUser.displayName || currentUser.email;
      }
      
      loadAssignments();
    }

    // Save assignment to local storage
    function saveAssignment(assignment) {
      const assignments = getAssignments();
      assignment.id = 'assign-' + Date.now();
      assignment.createdBy = currentUser.uid;
      assignment.createdAt = new Date().toISOString();
      assignments.push(assignment);
      localStorage.setItem('assignments', JSON.stringify(assignments));
      return assignment;
    }

    // Get assignments from local storage
    function getAssignments() {
      const stored = localStorage.getItem('assignments');
      return stored ? JSON.parse(stored) : [];
    }

    // Delete assignment from local storage
    function deleteAssignment(assignmentId) {
      const assignments = getAssignments();
      const filtered = assignments.filter(a => a.id !== assignmentId);
      localStorage.setItem('assignments', JSON.stringify(filtered));
    }

    // Load and display assignments
    function loadAssignments() {
      const assignments = getAssignments().filter(a => a.createdBy === currentUser.uid);
      const assignmentsList = document.getElementById('assignmentsList');
      
      if (assignments.length === 0) {
        assignmentsList.innerHTML = `
          <div class="col-span-full text-center text-gray-400 py-12">
            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <p class="text-lg">No assignments yet</p>
            <p class="text-sm text-gray-500 mt-1">Create your first assignment to get started</p>
          </div>
        `;
        return;
      }

      assignmentsList.innerHTML = '';
      assignments.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).forEach(assignment => {
        const dueDate = new Date(assignment.dueDate);
        const today = new Date();
        const isOverdue = dueDate < today;
        
        const card = document.createElement('div');
        card.className = 'assignment-card bg-gray-800 p-6 rounded-xl border border-gray-700 hover:border-sky-500 transition-all duration-300';
        card.innerHTML = `
          <div class="flex justify-between items-start mb-4">
            <h3 class="text-xl font-bold text-white">${assignment.title}</h3>
            <span class="px-2 py-1 text-xs rounded-full ${isOverdue ? 'bg-red-500' : 'bg-green-500'} text-white">
              ${isOverdue ? 'Overdue' : 'Active'}
            </span>
          </div>
          
          <p class="text-gray-400 mb-4 line-clamp-2">${assignment.description}</p>
          
          <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
            <span>ðŸ“Š ${assignment.dataSource}</span>
            <span>ðŸ‘¥ ${assignment.audience}</span>
            <span>ðŸ“… ${dueDate.toLocaleDateString()}</span>
          </div>
          
          <div class="flex gap-2">
            <button onclick="viewAssignment('${assignment.id}')" class="flex-1 bg-sky-600 hover:bg-sky-700 text-white font-medium py-2 rounded-lg transition">
              View Details
            </button>
            <button onclick="editAssignment('${assignment.id}')" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 rounded-lg transition">
              Edit
            </button>
            <button onclick="confirmDelete('${assignment.id}')" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-2 rounded-lg transition">
              Delete
            </button>
          </div>
        `;
        assignmentsList.appendChild(card);
      });
    }

    // Modal functions
    window.openCreateModal = function() {
      document.getElementById('createModal').classList.remove('hidden');
    };

    window.closeModal = function() {
      document.getElementById('createModal').classList.add('hidden');
      document.getElementById('assignmentForm').reset();
    };

    window.viewAssignment = function(assignmentId) {
      const assignments = getAssignments();
      const assignment = assignments.find(a => a.id === assignmentId);
      if (assignment) {
        alert(`Assignment Details:\n\nTitle: ${assignment.title}\nDescription: ${assignment.description}\nData Source: ${assignment.dataSource}\nDue Date: ${assignment.dueDate}\nQuestions:\n${assignment.questions.join('\n')}`);
      }
    };

    window.editAssignment = function(assignmentId) {
      const assignments = getAssignments();
      const assignment = assignments.find(a => a.id === assignmentId);
      if (assignment) {
        // Fill form with assignment data
        document.getElementById('assignmentTitle').value = assignment.title;
        document.getElementById('assignmentDesc').value = assignment.description;
        document.getElementById('assignmentData').value = assignment.dataSource;
        document.getElementById('assignmentAudience').value = assignment.audience;
        document.getElementById('assignmentDue').value = assignment.dueDate;
        document.getElementById('assignmentQuestions').value = assignment.questions.join('\n');
        
        openCreateModal();
      }
    };

    window.confirmDelete = function(assignmentId) {
      if (confirm('Are you sure you want to delete this assignment?')) {
        deleteAssignment(assignmentId);
        loadAssignments();
        alert('Assignment deleted successfully!');
      }
    };

    // Form submission
    document.getElementById('assignmentForm').addEventListener('submit', function(e) {
      e.preventDefault();

      try {
        const assignment = {
          title: document.getElementById('assignmentTitle').value,
          description: document.getElementById('assignmentDesc').value,
          dataSource: document.getElementById('assignmentData').value,
          audience: document.getElementById('assignmentAudience').value,
          dueDate: document.getElementById('assignmentDue').value,
          questions: document.getElementById('assignmentQuestions').value.split('\n').filter(q => q.trim()),
          submissions: 0,
          isPublished: true
        };

        saveAssignment(assignment);
        alert('Assignment created successfully!');
        closeModal();
        loadAssignments();
      } catch (error) {
        console.error('Error creating assignment:', error);
        alert('Failed to create assignment. Please try again.');
      }
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initializeUser);
  </script>

</body>
</html>
